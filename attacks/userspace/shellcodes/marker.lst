     1                                  BITS 32
     2                                  
     3 00000000 E808000000              	call near	string_get_address
     4 00000005 11EEEE11                	dd		0x11eeee11		; marker (endianness-insensitive!)
     5 00000009 FFFFFFFF                	dd		0xffffffff		; before mark: new SP, after mark: old SP
     6                                  string_get_address:
     7                                  	; get address of data
     8 0000000D 5A                      	pop		edx
     9                                  	; save old ESP and if new has been set by supervisor, set new ESP
    10 0000000E 8B4204                  	mov		eax, [edx+4]
    11 00000011 896204                  	mov		[edx+4], esp
    12 00000014 3DFFFFFFFF              	cmp		eax,0xffffffff
    13 00000019 7402                    	je		set_esp_done
    14 0000001B 89C4                    	mov		esp, eax
    15                                  set_esp_done:
    16                                  	; NOT the mark
    17 0000001D 8B02                    	mov		eax, [edx]
    18 0000001F F7D0                    	not		eax
    19 00000021 8902                    	mov		[edx], eax
    20                                  
    21                                  ; continue with other shellcode
